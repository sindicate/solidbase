#summary Getting Started with the SolidBase Maven plugin.

This Getting Started is generated by scripts/!GenerateGettingStarted.groovy

(Use !SolidBase 1.6.5 or newer.)

You should first read [GettingStartedCommandLineWithArguments Getting Started with SolidBase on the command-line]. That one contains details that are assumed knowledge in this Getting Started.

Create the upgrade script for the database named test-upgrade.sql and put it in a folder of your choosing:

{{{
--* DEFINITION
--*     SETUP "" --> "1.1"
--*     UPGRADE "" --> "1.0.1"
--*     UPGRADE "1.0.1" --> "1.0.2"
--* /DEFINITION



--* SETUP "" --> "1.1"

--* SECTION "Creating SolidBase control tables"

CREATE TABLE DBVERSION
(
    SPEC VARCHAR(5),
    VERSION VARCHAR(20),
    TARGET VARCHAR(20),
    STATEMENTS DECIMAL(4) NOT NULL
);

CREATE TABLE DBVERSIONLOG
(
    TYPE VARCHAR(1) NOT NULL,
    SOURCE VARCHAR(20),
    TARGET VARCHAR(20) NOT NULL,
    STATEMENT DECIMAL(4) NOT NULL,
    STAMP TIMESTAMP NOT NULL,
    COMMAND VARCHAR(4000),
    RESULT VARCHAR(4000)
);

CREATE INDEX DBVERSIONLOG_INDEX1 ON DBVERSIONLOG ( TYPE, TARGET );

--* /SETUP



--* UPGRADE "" --> "1.0.1"

--* SECTION "Creating table USERS"
CREATE TABLE USERS
(
    USER_ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_USERNAME VARCHAR(26) NOT NULL,
    USER_PASSWORD VARCHAR(30) NOT NULL
);

--* /UPGRADE



--* UPGRADE "1.0.1" --> "1.0.2"

--* SECTION "Inserting admin user"
INSERT INTO USERS ( USER_USERNAME, USER_PASSWORD ) VALUES ( 'admin', '*****' );

--* SECTION "Inserting user"
INSERT INTO USERS ( USER_USERNAME, USER_PASSWORD ) VALUES ( 'rene', '*****' );

--* /UPGRADE
}}}

You can find example upgrade scripts for Oracle, MySQL, Derby/JavaDB and HSQLDB/HyperSQL [http://code.google.com/p/solidbase/source/browse/trunk#trunk/dist here]. 

Add a pom.xml:

{{{
<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

	<modelVersion>4.0.0</modelVersion>
	
	<groupId>solidbase</groupId>
	<artifactId>mavenplugintest</artifactId>
	<version>1.0</version>
	<packaging>pom</packaging>

	<pluginRepositories>
		<pluginRepository>
			<id>solidbase</id>
			<name>SolidBase Repository</name>
			<layout>default</layout>
			<url>http://solidbase.googlecode.com/svn/repository</url>
			<releases><enabled>true</enabled></releases>
			<snapshots><enabled>false</enabled></snapshots>
		</pluginRepository>
	</pluginRepositories>

	<build>
		<plugins>
			<plugin>
				<groupId>solidbase</groupId>
				<artifactId>solidbase</artifactId>
				<version>1.6.5</version>
				<dependencies>
					<dependency>
						<groupId>org.apache.derby</groupId>
						<artifactId>derby</artifactId>
						<version>10.4.2.0</version>
					</dependency>
				</dependencies>
				<configuration>
					<driver>org.apache.derby.jdbc.EmbeddedDriver</driver>
					<url>jdbc:derby:testmaven;create=true</url>
					<username>app</username>
					<password></password>
					<upgradefile>test-upgrade.sql</upgradefile>
					<target>1.0.*</target>
				</configuration>
			</plugin>
		</plugins>
	</build>
  
</project>
}}}

The plugin is defined with a dependency on the database driver jar. This causes the driver jar to be included in the classpath when !SolidBase runs.

The folder now looks like:

{{{
G:\PROJECTS\BUILDS\solidbase\TEMP>dir
 Volume in drive G is WIN7
 Volume Serial Number is FAA5-5622

 Directory of G:\PROJECTS\BUILDS\solidbase\TEMP

07/25/2011  06:46 PM    <DIR>          .
07/25/2011  06:46 PM    <DIR>          ..
07/25/2011  06:46 PM             1,399 pom.xml
07/25/2011  06:46 PM             1,178 test-upgrade.sql
               2 File(s)          2,577 bytes
               2 Dir(s)   5,307,551,744 bytes free

G:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

Run the following command:

{{{
mvn solidbase:upgrade
}}}

You get the following output:

{{{
G:\PROJECTS\BUILDS\solidbase\TEMP>mvn solidbase:upgrade
[INFO] Scanning for projects...
Downloading: \
     http://solidbase.googlecode.com/svn/repository/solidbase/solidbase/1.6.5/solidbase-1.6.5.pom
1K downloaded  (solidbase-1.6.5.pom)
Downloading: \
     http://solidbase.googlecode.com/svn/repository/solidbase/solidbase/1.6.5/solidbase-1.6.5.jar
264K downloaded  (solidbase-1.6.5.jar)
[INFO] ------------------------------------------------------------------------
[INFO] Building Unnamed - solidbase:mavenplugintest:pom:1.0
[INFO]    task-segment: [solidbase:upgrade]
[INFO] ------------------------------------------------------------------------
[INFO] [solidbase:upgrade {execution: default-cli}]
[INFO] SolidBase v1.6.5-rev604 (http://solidbase.org)
[INFO] 
[INFO] Opening file 'G:\PROJECTS\BUILDS\solidbase\TEMP\test-upgrade.sql'
[INFO]     Encoding is 'ISO-8859-1'
[INFO] Connecting to database...
[INFO] The database is unmanaged.
[INFO] Setting up control tables to "1.1"
[INFO]     Creating SolidBase control tables...
[INFO] Upgrading to "1.0.1"
[INFO]     Creating table USERS...
[INFO] Upgrading "1.0.1" to "1.0.2"
[INFO]     Inserting admin user...
[INFO]     Inserting user...
[INFO] The database is upgraded.
[INFO] 
[INFO] Current database version is "1.0.2".
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 7 seconds
[INFO] Finished at: Mon Jul 25 18:46:52 CEST 2011
[INFO] Final Memory: 4M/15M
[INFO] ------------------------------------------------------------------------

G:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

Running it a second time will give:

{{{
G:\PROJECTS\BUILDS\solidbase\TEMP>mvn solidbase:upgrade
[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Building Unnamed - solidbase:mavenplugintest:pom:1.0
[INFO]    task-segment: [solidbase:upgrade]
[INFO] ------------------------------------------------------------------------
[INFO] [solidbase:upgrade {execution: default-cli}]
[INFO] SolidBase v1.6.5-rev604 (http://solidbase.org)
[INFO] 
[INFO] Opening file 'G:\PROJECTS\BUILDS\solidbase\TEMP\test-upgrade.sql'
[INFO]     Encoding is 'ISO-8859-1'
[INFO] Connecting to database...
[INFO] Current database version is "1.0.2".
[INFO] No upgrade is needed.
[INFO] 
[INFO] Current database version is "1.0.2".
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2 seconds
[INFO] Finished at: Mon Jul 25 18:46:55 CEST 2011
[INFO] Final Memory: 3M/15M
[INFO] ------------------------------------------------------------------------

G:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

It is also possible to let !SolidBase execute during a build phase, for example the pre-integration-test phase. For that you need to add an {{{<execution />}}} element to the plugin definition:

{{{
<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

	<modelVersion>4.0.0</modelVersion>
	
	<groupId>solidbase</groupId>
	<artifactId>mavenplugintest</artifactId>
	<version>1.0</version>
	<packaging>pom</packaging>

	<pluginRepositories>
		<pluginRepository>
			<id>solidbase</id>
			<name>SolidBase Repository</name>
			<layout>default</layout>
			<url>http://solidbase.googlecode.com/svn/repository</url>
			<releases><enabled>true</enabled></releases>
			<snapshots><enabled>false</enabled></snapshots>
		</pluginRepository>
	</pluginRepositories>

	<build>
		<plugins>
			<plugin>
				<groupId>solidbase</groupId>
				<artifactId>solidbase</artifactId>
				<version>1.6.5</version>
				<dependencies>
					<dependency>
						<groupId>org.apache.derby</groupId>
						<artifactId>derby</artifactId>
						<version>10.4.2.0</version>
    				</dependency>
				</dependencies>
				<configuration>
					<driver>org.apache.derby.jdbc.EmbeddedDriver</driver>
					<url>jdbc:derby:testmaven;create=true</url>
					<username>app</username>
					<password></password>
					<upgradefile>test-upgrade.sql</upgradefile>
					<target>1.0.*</target>
				</configuration>
				<executions>
					<execution>
						<id>solidbase-upgrade</id>
						<phase>pre-integration-test</phase>
						<goals><goal>upgrade</goal></goals>
					</execution>
				</executions>
			</plugin>
		</plugins>
	</build>
  
</project>
}}}

You can now run the mvn install command. Assuming all dependencies are already downloaded, you get:

{{{
G:\PROJECTS\BUILDS\solidbase\TEMP>mvn install
[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Building Unnamed - solidbase:mavenplugintest:pom:1.0
[INFO]    task-segment: [install]
[INFO] ------------------------------------------------------------------------
[INFO] [site:attach-descriptor {execution: default-attach-descriptor}]
[INFO] [solidbase:upgrade {execution: solidbase-upgrade}]
[INFO] SolidBase v1.6.5-rev604 (http://solidbase.org)
[INFO] 
[INFO] Opening file 'G:\PROJECTS\BUILDS\solidbase\TEMP\test-upgrade.sql'
[INFO]     Encoding is 'ISO-8859-1'
[INFO] Connecting to database...
[INFO] Current database version is "1.0.2".
[INFO] No upgrade is needed.
[INFO] 
[INFO] Current database version is "1.0.2".
[INFO] [install:install {execution: default-install}]
[INFO] Installing G:\PROJECTS\BUILDS\solidbase\TEMP\pom.xml to \
     G:\Users\Rene\.m2\repository\solidbase\mavenplugintest\1.0\mavenplugintest-1.0.pom
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 3 seconds
[INFO] Finished at: Mon Jul 25 18:47:03 CEST 2011
[INFO] Final Memory: 8M/20M
[INFO] ------------------------------------------------------------------------

G:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

This concludes the Getting Started with the Maven task.

Enjoy!
