#summary Getting Started with the SolidBase Maven plugin.

You should first read [GettingStartedCommandLineWithArguments Getting Started with SolidBase on the command-line]. That one contains details that are assumed knowledge in this Getting Started.

To start using the !SolidBase Maven plugin, put solidbase.jar in a folder, for example C:\TEMP. Get the driver jar for your database and put it in the same folder.

Create the upgrade script for the database named test-upgrade.sql:

{{{
--*	DEFINITION
--*		INIT "" --> "1.1"
--*		UPGRADE "" --> "1.0.1"
--*		UPGRADE "1.0.1" --> "1.0.2"
--*	/DEFINITION



--* INIT "" --> "1.1"

--* SET MESSAGE "    Creating table DBVERSION"

CREATE TABLE DBVERSION
(
	SPEC VARCHAR(5),
	VERSION VARCHAR(20), 
	TARGET VARCHAR(20), 
	STATEMENTS DECIMAL(4) NOT NULL
)
GO

--* SET MESSAGE "    Creating table DBVERSIONLOG"

CREATE TABLE DBVERSIONLOG
(
	TYPE VARCHAR(1) NOT NULL,
	SOURCE VARCHAR(20),
	TARGET VARCHAR(20) NOT NULL,
	STATEMENT DECIMAL(4) NOT NULL,
	STAMP TIMESTAMP NOT NULL,
	COMMAND VARCHAR(4000),
	RESULT VARCHAR(4000)
)
GO

CREATE INDEX DBVERSIONLOG_INDEX1 ON DBVERSIONLOG ( TYPE, TARGET )
GO

--* /INIT



--* UPGRADE "" --> "1.0.1"

--* SET MESSAGE "    Creating table USERS"

CREATE TABLE USERS
(
	USER_ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	USER_USERNAME VARCHAR(26) NOT NULL,
	USER_PASSWORD VARCHAR(30) NOT NULL
)
GO

--* /UPGRADE



--* UPGRADE "1.0.1" --> "1.0.2"

--* SET MESSAGE "    Inserting admin user"

INSERT INTO USERS ( USER_USERNAME, USER_PASSWORD ) VALUES ( 'admin', '*****' )
GO

--* SET MESSAGE "    Inserting user"

INSERT INTO USERS ( USER_USERNAME, USER_PASSWORD ) VALUES ( 'ren√©', '*****' )
GO

--* /UPGRADE
}}}

Create the pom.xml:

{{{
<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

	<modelVersion>4.0.0</modelVersion>
	
	<groupId>solidbase</groupId>
	<artifactId>mavenplugintest</artifactId>
	<version>1.0</version>
	<packaging>pom</packaging>

	<pluginRepositories>
		<pluginRepository>
			<id>solidbase</id>
			<name>SolidBase Repository</name>
			<layout>default</layout>
			<url>http://solidbase.googlecode.com/svn/repository</url>
			<releases><enabled>true</enabled></releases>
			<snapshots><enabled>false</enabled></snapshots>
		</pluginRepository>
	</pluginRepositories>

	<build>
		<plugins>
			<plugin>
				<groupId>solidbase</groupId>
				<artifactId>solidbase</artifactId>
				<version>1.5.2</version>
				<dependencies>
					<dependency>
						<groupId>org.apache.derby</groupId>
						<artifactId>derby</artifactId>
						<version>10.4.2.0</version>
					</dependency>
				</dependencies>
				<configuration>
					<driver>org.apache.derby.jdbc.EmbeddedDriver</driver>
					<url>jdbc:derby:testmaven;create=true</url>
					<username>app</username>
					<password></password>
					<upgradefile>test-upgrade.sql</upgradefile>
					<target>1.0.*</target>
				</configuration>
			</plugin>
		</plugins>
	</build>
  
</project>
}}}

The plugin is defined with a dependency on the database driver jar. This causes the driver jar to be included in the classpath when !SolidBase runs.

The folder now looks like:

{{{
C:\TEMP>dir
 Volume in drive C has no label.
 Volume Serial Number is FAA5-5622

 Directory of C:\TEMP

02/18/2010  09:00 PM    <DIR>          .
02/18/2010  09:00 PM    <DIR>          ..
11/01/2009  09:13 PM         2,253,277 derby-10.2.1.6.jar
02/18/2010  08:58 PM             1,402 pom.xml
02/14/2010  10:35 PM           249,540 solidbase.jar
02/14/2010  10:11 PM             1,286 test-upgrade.sql
               4 File(s)      2,505,505 bytes
               2 Dir(s)  33,371,439,104 bytes free

C:\TEMP>
}}}

Run the following command:

{{{
mvn solidbase:upgrade
}}}

You get the following output:

{{{
C:\TEMP>mvn solidbase:upgrade

[INFO] Scanning for projects...
Downloading: http://solidbase.googlecode.com/svn/repository/solidbase/solidbase/1.5.2/solidbase-1.5.2.pom
1K downloaded  (solidbase-1.5.2.pom)
Downloading: http://solidbase.googlecode.com/svn/repository/solidbase/solidbase/1.5.2/solidbase-1.5.2.jar
243K downloaded  (solidbase-1.5.2.jar)
[INFO] ------------------------------------------------------------------------
[INFO] Building Unnamed - solidbase:mavenplugintest:pom:1.0
[INFO]    task-segment: [solidbase:upgrade]
[INFO] ------------------------------------------------------------------------
Downloading: http://solidbase.googlecode.com/svn/repository/org/apache/derby/derby/10.4.2.0/derby-10.4.2.0.pom
[INFO] Unable to find resource 'org.apache.derby:derby:pom:10.4.2.0' in repository solidbase (http://solidbase.googlecode.com/svn/repository)
Downloading: http://repo1.maven.org/maven2/org/apache/derby/derby/10.4.2.0/derby-10.4.2.0.pom

Downloading: http://solidbase.googlecode.com/svn/repository/org/codehaus/plexus/plexus-utils/1.1/plexus-utils-1.1.pom
[INFO] Unable to find resource 'org.codehaus.plexus:plexus-utils:pom:1.1' in repository solidbase (http://solidbase.googlecode.com/svn/repository)
Downloading: http://repo1.maven.org/maven2/org/codehaus/plexus/plexus-utils/1.1/plexus-utils-1.1.pom

Downloading: http://solidbase.googlecode.com/svn/repository/org/codehaus/plexus/plexus/1.0.4/plexus-1.0.4.pom
[INFO] Unable to find resource 'org.codehaus.plexus:plexus:pom:1.0.4' in repository solidbase (http://solidbase.googlecode.com/svn/repository)
Downloading: http://repo1.maven.org/maven2/org/codehaus/plexus/plexus/1.0.4/plexus-1.0.4.pom

Downloading: http://solidbase.googlecode.com/svn/repository/org/codehaus/plexus/plexus-utils/1.1/plexus-utils-1.1.jar
Downloading: http://solidbase.googlecode.com/svn/repository/org/apache/derby/derby/10.4.2.0/derby-10.4.2.0.jar
[INFO] Unable to find resource 'org.codehaus.plexus:plexus-utils:jar:1.1' in repository solidbase (http://solidbase.googlecode.com/svn/repository)
Downloading: http://repo1.maven.org/maven2/org/codehaus/plexus/plexus-utils/1.1/plexus-utils-1.1.jar
[INFO] Unable to find resource 'org.apache.derby:derby:jar:10.4.2.0' in repository solidbase (http://solidbase.googlecode.com/svn/repository)
Downloading: http://repo1.maven.org/maven2/org/apache/derby/derby/10.4.2.0/derby-10.4.2.0.jar


[INFO] [solidbase:upgrade {execution: default-cli}]
[INFO] SolidBase v1.5.2-rev321
[INFO] (C) 2006-2010 Rene M. de Bloois
[INFO]
[INFO] Connecting to database...
[INFO] The database has no version yet.
[INFO] Opening file 'C:\TEMP\test-upgrade.sql'
[INFO]     Encoding is 'ISO-8859-1'
[INFO] Initializing to "1.1"
[INFO]     Creating table DBVERSION.
[INFO]     Creating table DBVERSIONLOG..
[INFO] Upgrading to "1.0.1"
[INFO]     Creating table USERS.
[INFO] Upgrading "1.0.1" to "1.0.2"
[INFO]     Inserting admin user.
[INFO]     Inserting user.
[INFO] The database is upgraded.
[INFO]
[INFO] Current database version is "1.0.2".
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 17 seconds
[INFO] Finished at: Thu Feb 18 21:02:35 CET 2010
[INFO] Final Memory: 3M/15M
[INFO] ------------------------------------------------------------------------
C:\TEMP>
}}}

Running it a second time will give:

{{{
C:\TEMP>mvn solidbase:upgrade
[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Building Unnamed - solidbase:mavenplugintest:pom:1.0
[INFO]    task-segment: [solidbase:upgrade]
[INFO] ------------------------------------------------------------------------
[INFO] [solidbase:upgrade {execution: default-cli}]
[INFO] SolidBase v1.5.2-rev321
[INFO] (C) 2006-2010 Rene M. de Bloois
[INFO]
[INFO] Connecting to database...
[INFO] Current database version is "1.0.2".
[INFO] Opening file 'C:\TEMP\test-upgrade.sql'
[INFO]     Encoding is 'ISO-8859-1'
[INFO] The database is upgraded.
[INFO]
[INFO] Current database version is "1.0.2".
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2 seconds
[INFO] Finished at: Thu Feb 18 21:08:54 CET 2010
[INFO] Final Memory: 2M/15M
[INFO] ------------------------------------------------------------------------
C:\TEMP>
}}}

As expected, no more downloading of the dependencies.

It is also possible to let !SolidBase during an existing phase, for example the pre-integration-test phase. For that you need to add an {{{<execution />}}} element to the plugin definition:

{{{
<?xml version="1.0" encoding="UTF-8"?>

<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">

	<modelVersion>4.0.0</modelVersion>
	
	<groupId>solidbase</groupId>
	<artifactId>mavenplugintest</artifactId>
	<version>1.0</version>
	<packaging>pom</packaging>

	<pluginRepositories>
		<pluginRepository>
			<id>solidbase</id>
			<name>SolidBase Repository</name>
			<layout>default</layout>
			<url>http://solidbase.googlecode.com/svn/repository</url>
			<releases><enabled>true</enabled></releases>
			<snapshots><enabled>false</enabled></snapshots>
		</pluginRepository>
	</pluginRepositories>

	<build>
		<plugins>
			<plugin>
				<groupId>solidbase</groupId>
				<artifactId>solidbase</artifactId>
				<version>1.5.2</version>
				<dependencies>
					<dependency>
						<groupId>org.apache.derby</groupId>
						<artifactId>derby</artifactId>
						<version>10.4.2.0</version>
    				</dependency>
				</dependencies>
				<configuration>
					<driver>org.apache.derby.jdbc.EmbeddedDriver</driver>
					<url>jdbc:derby:testmaven;create=true</url>
					<username>app</username>
					<password></password>
					<upgradefile>test-upgrade.sql</upgradefile>
					<target>1.0.*</target>
				</configuration>
				<executions>
					<execution>
						<id>solidbase-upgrade</id>
						<phase>pre-integration-test</phase>
						<goals><goal>upgrade</goal></goals>
					</execution>
				</executions>
			</plugin>
		</plugins>
	</build>
  
</project>
}}}

You can now run the mvn install command. Assuming all dependencies are already downloaded, you get:

{{{
C:\TEMP>mvn install
[INFO] Scanning for projects...
[INFO] ------------------------------------------------------------------------
[INFO] Building Unnamed - solidbase:mavenplugintest:pom:1.0
[INFO]    task-segment: [install]
[INFO] ------------------------------------------------------------------------
[INFO] [site:attach-descriptor {execution: default-attach-descriptor}]
[INFO] [solidbase:upgrade {execution: solidbase-upgrade}]
[INFO] SolidBase v1.5.2-rev321
[INFO] (C) 2006-2010 Rene M. de Bloois
[INFO]
[INFO] Connecting to database...
[INFO] Current database version is "1.0.2".
[INFO] Opening file 'C:\TEMP\test-upgrade.sql'
[INFO]     Encoding is 'ISO-8859-1'
[INFO] The database is upgraded.
[INFO]
[INFO] Current database version is "1.0.2".
[INFO] [install:install {execution: default-install}]
[INFO] Installing C:\TEMP\pom.xml to C:\Users\Rene\.m2\repository\solidbase\mavenplugintest\1.0\mavenplugintest-1.0.pom
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESSFUL
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 2 seconds
[INFO] Finished at: Thu Feb 18 21:17:49 CET 2010
[INFO] Final Memory: 8M/19M
[INFO] ------------------------------------------------------------------------
C:\TEMP>
}}}

This concludes the Getting Started with the Maven plugin.

Have a happy time playing with !SolidBase!