#summary Getting Started with SolidBase on the command-line.

This Getting Started is generated by scripts/!GenerateGettingStarted.groovy

(Use !SolidBase 1.6.0 or newer.)

To start using !SolidBase on the command line put solidbase.jar in a folder of your choosing. Get the driver jar for your database and put it in the same folder. Your folder now looks like:

{{{
C:\PROJECTS\BUILDS\solidbase\TEMP>dir
 Volume in drive C has no label.
 Volume Serial Number is FAA5-5622

 Directory of C:\PROJECTS\BUILDS\solidbase\TEMP

06/05/2010  07:04 PM    <DIR>          .
06/05/2010  07:04 PM    <DIR>          ..
05/25/2010  08:23 PM         2,512,189 derby-10.5.3.0.jar
06/03/2010  05:44 PM           288,397 solidbase.jar
               2 File(s)      2,800,586 bytes
               2 Dir(s)   7,917,920,256 bytes free

C:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

Create an upgrade script for the database. The upgrade script starts with a definition and an initialization to create the required tables that !SolidBase needs.

test-upgrade.sql:
{{{
--* DEFINITION
--*     INIT "" --> "1.1"
--* /DEFINITION



--* INIT "" --> "1.1"

--* SECTION "Creating table DBVERSION"

CREATE TABLE DBVERSION
(
    SPEC VARCHAR(5),
    VERSION VARCHAR(20),
    TARGET VARCHAR(20),
    STATEMENTS DECIMAL(4) NOT NULL
)
GO

--* SECTION "Creating table DBVERSIONLOG"

CREATE TABLE DBVERSIONLOG
(
    TYPE VARCHAR(1) NOT NULL,
    SOURCE VARCHAR(20),
    TARGET VARCHAR(20) NOT NULL,
    STATEMENT DECIMAL(4) NOT NULL,
    STAMP TIMESTAMP NOT NULL,
    COMMAND VARCHAR(4000),
    RESULT VARCHAR(4000)
)
GO

CREATE INDEX DBVERSIONLOG_INDEX1 ON DBVERSIONLOG ( TYPE, TARGET )
GO

--* /INIT
}}}

Version 1.1 indicates to !SolidBase what the structure is of the DBVERSION and DBVERSIONLOG tables. So you shouldn't change that. The folder now looks like:

{{{
C:\PROJECTS\BUILDS\solidbase\TEMP>dir
 Volume in drive C has no label.
 Volume Serial Number is FAA5-5622

 Directory of C:\PROJECTS\BUILDS\solidbase\TEMP

06/05/2010  07:04 PM    <DIR>          .
06/05/2010  07:04 PM    <DIR>          ..
05/25/2010  08:23 PM         2,512,189 derby-10.5.3.0.jar
06/03/2010  05:44 PM           288,397 solidbase.jar
06/05/2010  07:04 PM               620 test-upgrade.sql
               3 File(s)      2,801,206 bytes
               2 Dir(s)   7,917,912,064 bytes free

C:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

Run the following command:

{{{
java -jar solidbase.jar
}}}

You get the following output:

{{{
C:\PROJECTS\BUILDS\solidbase\TEMP>java -jar solidbase.jar
usage: solidbase [-config <filename>] [-downgradeallowed] [-driver <classname>]
       [-dumplog <filename>] [-help] [-password <password>] [-sqlfile <arg>]
       [-target <version>] [-upgradefile <filename>] [-url <url>] [-username
       <username>] [-verbose]
 -config <filename>        specifies a properties file to use
 -downgradeallowed         allow downgrades to reach the target
 -driver <classname>       sets the JDBC driverclass
 -dumplog <filename>       export historical upgrade results to an XML file
 -help                     Brings up this page
 -password <password>      sets the password of the default user
 -sqlfile <arg>            specifies an SQL file to execute
 -target <version>         sets the target version to upgrade to
 -upgradefile <filename>   specifies the file containing the database upgrades
 -url <url>                sets the URL for the database
 -username <username>      sets the default user name to connect with
 -verbose                  be extra verbose

C:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

In this help page you see that you need to specify the -driver, -url, -username and -upgradefile:

{{{
C:\PROJECTS\BUILDS\solidbase\TEMP>java -jar solidbase.jar -driver \
     org.apache.derby.jdbc.EmbeddedDriver -url jdbc:derby:test;create=true \
     -username app -upgradefile test-upgrade.sql
6/5/10 7:04 PM   SolidBase v1.6.0-rev430
6/5/10 7:04 PM   (C) 2006-2010 Rene M. de Bloois


java.lang.ClassNotFoundException: org.apache.derby.jdbc.EmbeddedDriver
	at java.net.URLClassLoader$1.run(URLClassLoader.java:202)
	at java.security.AccessController.doPrivileged(Native Method)
	at java.net.URLClassLoader.findClass(URLClassLoader.java:190)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:307)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:301)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:248)
	at java.lang.Class.forName0(Native Method)
	at java.lang.Class.forName(Class.java:169)
	at solidbase.core.Database.<init>(Database.java:90)
	at solidbase.Main.main0(Main.java:214)
	at solidbase.Main.pass2(Main.java:346)
	at solidbase.Main.reload(Main.java:258)
	at solidbase.Main.main0(Main.java:161)
	at solidbase.Main.main(Main.java:81)

C:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

But this is not right. We have to add the driver jar to the classpath. When using Ant or Maven you can use Ant or Maven techniques. When using the solidbase.properties file you can do that in there (shown below). But now we have to use the java way like this (press enter when asked for the password):

{{{
C:\PROJECTS\BUILDS\solidbase\TEMP>java -cp solidbase.jar;derby-10.5.3.0.jar \
     solidbase.Main -driver org.apache.derby.jdbc.EmbeddedDriver -url \
     jdbc:derby:test;create=true -username app -upgradefile test-upgrade.sql
6/5/10 7:04 PM   SolidBase v1.6.0-rev430
6/5/10 7:04 PM   (C) 2006-2010 Rene M. de Bloois

6/5/10 7:04 PM   Opening file 'test-upgrade.sql'
6/5/10 7:04 PM       Encoding is 'ISO-8859-1'
6/5/10 7:04 PM   Connecting to database...
6/5/10 7:04 PM   Input password for user 'app': 
6/5/10 7:04 PM   The database has no version yet.
6/5/10 7:04 PM   Initializing to "1.1"
6/5/10 7:04 PM       Creating table DBVERSION.
6/5/10 7:04 PM       Creating table DBVERSIONLOG..

6/5/10 7:04 PM   ERROR: The current database version (no version) is not \
     available in the upgrade file. Maybe this version is deprecated or the wrong \
     upgrade file is used.

C:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

So what happened here? The database has no version yet. This is recognized as "no version". !SolidBase always checks if the current version exists in the upgrade file, because if not, this means that this version is either deprecated (removed from the upgrade file) or an upgrade file is used that does not belong to the database.

We need to add an upgrade path to the upgrade file. The result might look like this:

{{{
--* DEFINITION
--*     INIT "" --> "1.1"
--*     UPGRADE "" --> "1.0.1"
--* /DEFINITION



--* INIT "" --> "1.1"

--* SECTION "Creating table DBVERSION"

CREATE TABLE DBVERSION
(
    SPEC VARCHAR(5),
    VERSION VARCHAR(20),
    TARGET VARCHAR(20),
    STATEMENTS DECIMAL(4) NOT NULL
)
GO

--* SECTION "Creating table DBVERSIONLOG"

CREATE TABLE DBVERSIONLOG
(
    TYPE VARCHAR(1) NOT NULL,
    SOURCE VARCHAR(20),
    TARGET VARCHAR(20) NOT NULL,
    STATEMENT DECIMAL(4) NOT NULL,
    STAMP TIMESTAMP NOT NULL,
    COMMAND VARCHAR(4000),
    RESULT VARCHAR(4000)
)
GO

CREATE INDEX DBVERSIONLOG_INDEX1 ON DBVERSIONLOG ( TYPE, TARGET )
GO

--* /INIT



--* UPGRADE "" --> "1.0.1"

--* SECTION "Creating table USERS"

CREATE TABLE USERS
(
    USER_ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_USERNAME VARCHAR(26) NOT NULL,
    USER_PASSWORD VARCHAR(30) NOT NULL
)
GO

--* /UPGRADE
}}}

When you repeat the previous command you get:

{{{
C:\PROJECTS\BUILDS\solidbase\TEMP>java -cp solidbase.jar;derby-10.5.3.0.jar \
     solidbase.Main -driver org.apache.derby.jdbc.EmbeddedDriver -url \
     jdbc:derby:test;create=true -username app -upgradefile test-upgrade.sql
6/5/10 7:04 PM   SolidBase v1.6.0-rev430
6/5/10 7:04 PM   (C) 2006-2010 Rene M. de Bloois

6/5/10 7:04 PM   Opening file 'test-upgrade.sql'
6/5/10 7:04 PM       Encoding is 'ISO-8859-1'
6/5/10 7:04 PM   Connecting to database...
6/5/10 7:04 PM   Input password for user 'app': 
6/5/10 7:04 PM   The database has no version yet.
6/5/10 7:04 PM   Upgrading to "1.0.1"
6/5/10 7:04 PM       Creating table USERS.
6/5/10 7:04 PM   The database is upgraded.

6/5/10 7:04 PM   Current database version is "1.0.1".

C:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

!SolidBase works incremental. You can add a change to the upgrade file and run !SolidBase again. Add the following to the upgrade file:

{{{
--* UPGRADE "1.0.1" --> "1.0.2"

--* SECTION "Inserting admin user"

INSERT INTO USERS ( USER_USERNAME, USER_PASSWORD ) VALUES ( 'admin', '*****' )
GO

--* SECTION "Inserting user"

INSERT INTO USERS ( USER_USERNAME, USER_PASSWORD ) VALUES ( 'renÃ©', '*****' )
GO

--* /UPGRADE
}}}

You get the following result:

{{{
C:\PROJECTS\BUILDS\solidbase\TEMP>java -cp solidbase.jar;derby-10.5.3.0.jar \
     solidbase.Main -driver org.apache.derby.jdbc.EmbeddedDriver -url \
     jdbc:derby:test;create=true -username app -upgradefile test-upgrade.sql
6/5/10 7:04 PM   SolidBase v1.6.0-rev430
6/5/10 7:04 PM   (C) 2006-2010 Rene M. de Bloois

6/5/10 7:04 PM   Opening file 'test-upgrade.sql'
6/5/10 7:04 PM       Encoding is 'ISO-8859-1'

6/5/10 7:04 PM   ERROR: Undefined upgrade block found: "1.0.1" --> "1.0.2", at line 58

C:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

Problem is, we only added the change itself, but forgot to define it. The definition in the top of the file is needed to give a better overview of the contents of the upgrade. Change the definition to this:

{{{
--* DEFINITION
--*     INIT "" --> "1.1"
--*     UPGRADE "" --> "1.0.1"
--*     UPGRADE "1.0.1" --> "1.0.2"
--* /DEFINITION
}}}

If you run the upgrade again, you get:

{{{
C:\PROJECTS\BUILDS\solidbase\TEMP>java -cp solidbase.jar;derby-10.5.3.0.jar \
     solidbase.Main -driver org.apache.derby.jdbc.EmbeddedDriver -url \
     jdbc:derby:test;create=true -username app -upgradefile test-upgrade.sql
6/5/10 7:04 PM   SolidBase v1.6.0-rev430
6/5/10 7:04 PM   (C) 2006-2010 Rene M. de Bloois

6/5/10 7:04 PM   Opening file 'test-upgrade.sql'
6/5/10 7:04 PM       Encoding is 'ISO-8859-1'
6/5/10 7:04 PM   Connecting to database...
6/5/10 7:04 PM   Input password for user 'app': 
6/5/10 7:04 PM   Current database version is "1.0.1".
6/5/10 7:04 PM   Upgrading "1.0.1" to "1.0.2"
6/5/10 7:04 PM       Inserting admin user.
6/5/10 7:04 PM       Inserting user.
6/5/10 7:04 PM   The database is upgraded.

6/5/10 7:04 PM   Current database version is "1.0.2".

C:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

Below we are going to use the solidbase.properties file to set some default properties. This makes the command-line version of !SolidBase easier to use.

When a solidbase.properties file is found in the working folder, it will be read automatically. You can add default values for certain properties in it, for example the extra jars and the driver class name. Add a solidbase.properties file:

{{{
properties-version = 1.0

# add jars to the classpath
classpath.ext = derby-10.5.3.0.jar

# primary connection
connection.driver = org.apache.derby.jdbc.EmbeddedDriver
}}}

The folder now looks like:

{{{
C:\PROJECTS\BUILDS\solidbase\TEMP>dir
 Volume in drive C has no label.
 Volume Serial Number is FAA5-5622

 Directory of C:\PROJECTS\BUILDS\solidbase\TEMP

06/05/2010  07:04 PM    <DIR>          .
06/05/2010  07:04 PM    <DIR>          ..
05/25/2010  08:23 PM         2,512,189 derby-10.5.3.0.jar
06/05/2010  07:04 PM               359 derby.log
06/03/2010  05:44 PM           288,397 solidbase.jar
06/05/2010  07:04 PM               168 solidbase.properties
06/05/2010  07:04 PM    <DIR>          test
06/05/2010  07:04 PM             1,224 test-upgrade.sql
               5 File(s)      2,802,337 bytes
               3 Dir(s)   7,915,950,080 bytes free

C:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

Now we can remove the -classpath and the -driver arguments from the commandline:

{{{
C:\PROJECTS\BUILDS\solidbase\TEMP>java -jar solidbase.jar -url \
     jdbc:derby:test;create=true -username app -upgradefile test-upgrade.sql
6/5/10 7:04 PM   SolidBase v1.6.0-rev430
6/5/10 7:04 PM   (C) 2006-2010 Rene M. de Bloois

6/5/10 7:04 PM   Opening file 'test-upgrade.sql'
6/5/10 7:04 PM       Encoding is 'ISO-8859-1'
6/5/10 7:04 PM   Connecting to database...
6/5/10 7:04 PM   Input password for user 'app': 
6/5/10 7:04 PM   Current database version is "1.0.2".
6/5/10 7:04 PM   The database is upgraded.

6/5/10 7:04 PM   Current database version is "1.0.2".

C:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

This concludes the Getting Started with the command line version of !SolidBase.

Have a nice time playing with !SolidBase!
