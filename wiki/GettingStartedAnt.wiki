#summary Getting Started with the SolidBase Ant task.

This Getting Started is generated by scripts/!GenerateGettingStarted.groovy

(Use !SolidBase 1.6.0 or newer.)

You should first read [GettingStartedCommandLineWithArguments Getting Started with SolidBase on the command-line]. That one contains details that are assumed knowledge in this Getting Started.

To start using !SolidBase's Ant task, put solidbase.jar in a folder of your choosing. Get the driver jar for your database and put it in the same folder.

Create the upgrade script for the database named test-upgrade.sql:

{{{
--* DEFINITION
--*     INIT "" --> "1.1"
--*     UPGRADE "" --> "1.0.1"
--*     UPGRADE "1.0.1" --> "1.0.2"
--* /DEFINITION



--* INIT "" --> "1.1"

--* SECTION "Creating table DBVERSION"

CREATE TABLE DBVERSION
(
    SPEC VARCHAR(5),
    VERSION VARCHAR(20),
    TARGET VARCHAR(20),
    STATEMENTS DECIMAL(4) NOT NULL
)
GO

--* SECTION "Creating table DBVERSIONLOG"

CREATE TABLE DBVERSIONLOG
(
    TYPE VARCHAR(1) NOT NULL,
    SOURCE VARCHAR(20),
    TARGET VARCHAR(20) NOT NULL,
    STATEMENT DECIMAL(4) NOT NULL,
    STAMP TIMESTAMP NOT NULL,
    COMMAND VARCHAR(4000),
    RESULT VARCHAR(4000)
)
GO

CREATE INDEX DBVERSIONLOG_INDEX1 ON DBVERSIONLOG ( TYPE, TARGET )
GO

--* /INIT



--* UPGRADE "" --> "1.0.1"

--* SECTION "Creating table USERS"

CREATE TABLE USERS
(
    USER_ID INT NOT NULL GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    USER_USERNAME VARCHAR(26) NOT NULL,
    USER_PASSWORD VARCHAR(30) NOT NULL
)
GO

--* /UPGRADE



--* UPGRADE "1.0.1" --> "1.0.2"

--* SECTION "Inserting admin user"

INSERT INTO USERS ( USER_USERNAME, USER_PASSWORD ) VALUES ( 'admin', '*****' )
GO

--* SECTION "Inserting user"

INSERT INTO USERS ( USER_USERNAME, USER_PASSWORD ) VALUES ( 'rené', '*****' )
GO

--* /UPGRADE
}}}

Create the build.xml:

{{{
<?xml version="1.0" encoding="UTF-8"?>

<project basedir=".">

	<taskdef resource="solidbasetasks" classpath="solidbase.jar;derby-10.5.3.0.jar" />

	<target name="upgradedb">
		<solidbase-upgrade driver="org.apache.derby.jdbc.EmbeddedDriver" url="jdbc:derby:testant;create=true" 
			username="app" password="" 
			upgradefile="test-upgrade.sql" target="1.0.*" />
	</target>

</project>
}}}

The taskdef element also adds the driver jar to the classpath to make it available to !SolidBase.

The folder now looks like:

{{{
C:\PROJECTS\BUILDS\solidbase\TEMP>dir
 Volume in drive C has no label.
 Volume Serial Number is FAA5-5622

 Directory of C:\PROJECTS\BUILDS\solidbase\TEMP

06/05/2010  09:36 PM    <DIR>          .
06/05/2010  09:36 PM    <DIR>          ..
06/05/2010  09:36 PM               386 build.xml
05/25/2010  08:23 PM         2,512,189 derby-10.5.3.0.jar
06/03/2010  05:44 PM           288,397 solidbase.jar
06/05/2010  09:36 PM             1,224 test-upgrade.sql
               4 File(s)      2,802,196 bytes
               2 Dir(s)   8,296,456,192 bytes free

C:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

Run the following command:

{{{
ant upgradedb
}}}

You get the following output:

{{{
C:\PROJECTS\BUILDS\solidbase\TEMP>ant upgradedb
Buildfile: C:\PROJECTS\BUILDS\solidbase\TEMP\build.xml

upgradedb:
[solidbase-upgrade] SolidBase v1.6.0-rev430
[solidbase-upgrade] (C) 2006-2010 Rene M. de Bloois
[solidbase-upgrade] 
[solidbase-upgrade] Opening file 'C:\PROJECTS\BUILDS\solidbase\TEMP\test-upgrade.sql'
[solidbase-upgrade]     Encoding is 'ISO-8859-1'
[solidbase-upgrade] Connecting to database...
[solidbase-upgrade] The database has no version yet.
[solidbase-upgrade] Initializing to "1.1"
[solidbase-upgrade]     Creating table DBVERSION.
[solidbase-upgrade]     Creating table DBVERSIONLOG..
[solidbase-upgrade] Upgrading to "1.0.1"
[solidbase-upgrade]     Creating table USERS.
[solidbase-upgrade] Upgrading "1.0.1" to "1.0.2"
[solidbase-upgrade]     Inserting admin user.
[solidbase-upgrade]     Inserting user.
[solidbase-upgrade] The database is upgraded.
[solidbase-upgrade] 
[solidbase-upgrade] Current database version is "1.0.2".

BUILD SUCCESSFUL
Total time: 5 seconds

C:\PROJECTS\BUILDS\solidbase\TEMP>
}}}

This concludes the Getting Started with the Ant task.

Have a nice time playing with !SolidBase!
